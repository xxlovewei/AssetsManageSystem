<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="description" content="">
<meta name="keywords" content="">
<meta name="viewport"
	content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="format-detection" content="telephone=no">
<meta http-equiv="Expires" CONTENT="-1">
<meta http-equiv="Cache-Control" CONTENT="no-cache">
<meta http-equiv="Pragma" CONTENT="no-cache">
<title>位置信息</title>
</head>
<body>
	<script type="text/javascript" src="./js/jquery.js"></script>
	<script src="https://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
	<script>
		var link = location.href;
		console.log(link);
		$.ajax({
			url : "/dt/api/demo/getJsTicket.do",//后台给你提供的接口
			type : "GET",
			data : {
				"url" : link
			},
			async : true,
			//dataType : "json",
			success : function(res) {
				console.log(res);
				var data = res.data;
				/* 	r.put("signature", ret.get("signature"));
					r.put("appId", ret.get("appId"));
					r.put("nonceStr", ret.get("nonceStr"));
					r.put("timestamp", ret.get("timestamp")); */
				console.log(data.appId);
				console.log(data.timestamp);
				console.log(data.nonceStr);
				console.log(data.signature);
					
				wx.config({
					debug : true,
					appId : data.appId, // 必填，公众号的唯一标识
					timestamp : data.timestamp, // 必填，生成签名的时间戳
					nonceStr : data.nonceStr, // 必填，生成签名的随机串
					signature : data.signature,// 必填，签名，见附录1
					jsApiList : [ 'checkJsApi', 'openLocation', 'getLocation' ]
				});
				wx.error(function(res) {
					alert(res);
				});
			},
			error : function(error) {
				alert(error)
			}
		});

		wx.ready(function() {
			wx.getLocation({
				type : 'gcj02', // 默认为wgs84的gps坐标，如果要返回直接给openLocation用的火星坐标，可传入'gcj02'
				success : function(res) {
					var latitude = res.latitude; // 纬度，浮点数，范围为90 ~ -90
					var longitude = res.longitude; // 经度，浮点数，范围为180 ~ -180。
					var speed = res.speed; // 速度，以米/每秒计
					var accuracy = res.accuracy; // 位置精度
					alert(latitude + "," + longitude)
					wx.openLocation({
						latitude : latitude, // 纬度，浮点数，范围为90 ~ -90
						longitude : longitude, // 经度，浮点数，范围为180 ~ -180。
						name : '雅戈尔旗舰店(KK)', // 位置名
						address : '详细地址略...', // 地址详情说明
						scale : 20, // 地图缩放级别,整形值,范围从1~28。默认为最大
						infoUrl : 'http://www.baidu.com' // 在查看位置界面底部显示的超链接,可点击跳转
					});

				}
			});
		});
	</script>
</body>

</html>