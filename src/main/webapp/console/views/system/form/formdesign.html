
<!DOCTYPE html>
<html>

<head>
<title>表单设计器kcz</title>
<meta charset="UTF-8">
<link rel="stylesheet" href="../../../plugin/form/k-form-design.css">
</head>

<body>
	<div id="app">
		<k-form-design ref="KFB" title="表单设计器" @save="handleSave"></k-form-design>
	</div>
	<script src="../../../plugin/form/vue.min.js"></script>
	<script
		src="../../../plugin/form/k-form-design.umd.min.js"></script>
	<script src="../../../plugin/form/vue-resource.min.js"></script>
	<script>
	
	 
	function getArgs() { 
	    var args = {};
	        var query = location.search.substring(1);
	         // Get query string
	    var pairs = query.split("&"); 
	                    // Break at ampersand
	     for(var i = 0; i < pairs.length; i++) {
	            var pos = pairs[i].indexOf('=');
	             // Look for "name=value"
	            if (pos == -1) continue;
	                    // If not found, skip
	                var argname = pairs[i].substring(0,pos);// Extract the name
	                var value = pairs[i].substring(pos+1);// Extract the value
	                value = decodeURIComponent(value);// Decode it, if needed
	                args[argname] = value;
	                        // Store as a property
	        }
	    return args;// Return the object 
	 }
 

	 
	var getpar=getArgs();
	var url = window.location.host; 
	console.log(url);
 	 Vue.http.get('http://'+url+'/dt/api/form/sysForm//selectById.do?id='+getpar.id).then(function(res){
         console.log(res.body.data);   
         let jsonData = {"list":[],"config":{"layout":"horizontal","labelCol":{"span":4},"wrapperCol":{"span":18},"hideRequiredMark":false,"customStyle":""}}
  		var ct2=decodeURI(res.body.data.ct);
         console.log("ct2",ct2);
         var jsonData2={};
         if (typeof (ct2) == 'undefined' ||ct2== undefined||ct2== 'undefined'){
        	 jsonData2=jsonData;
         }else{
        	 jsonData2=JSON.parse(ct2); 
         }
      
         console.log(jsonData2);
         //jsonData2=jsonData;
         let vm = new Vue({
           el: '#app',
           data: {
             jsonData
           },
           mounted () {
        	   this.init()
        	  },
           methods: {
        	   init(){
        			 this.$refs.KFB.handleSetData(jsonData2);
               },
         	  importData(){
         		 this.$refs.KFB.handleSetData(jsonData);
         	  },
         	  handleSave(val){
                  var valstr=JSON.stringify(val);
                  console.log(valstr);
         		  var url=""
         		  
         			 this.$http({
         			    url: 'http://'+url+"/dt/api/form/sysForm/insertOrUpdate.do",
         			    headers: {
         			        'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8',
         			    },
         			    emulateJSON: true, //以application/x-www-form-urlencoded的请求头部发送参数
         			    method: "POST",
         			    body: {
         			    	id:getpar.id,ct:encodeURI(val)
         			    }
         			}).then(reponse => {
         			    if (reponse.status == "200") {
         			    	  alert("操作成功");
         			    }
         			})
         			
         			
         		/*   this.$http('http://127.0.0.1:8080/dt/api/form/sysForm/insertOrUpdate.do',
         				  {id:getpar.id,ct:val},
         				  headers: {'Content-Type': 'application/x-www-form-urlencoded'}
         				  ,emulateJSON : true,
         				 method: "POST",
         				 ).then(function(res){
                      console.log(res);   
                      alert("操作成功");
                   },function(){
                       console.log('请求失败处理');
                   }); */
         	 },
             handleSubmit() {
             }
           }
         })
         
         
         
         
      },function(){
          console.log('请求数据失败');
      });
	  
	
  </script>
</body>

</html>